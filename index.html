<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>C.R.I.S. // FIXED HEIGHT</title>
    <style>
        :root { --green: #33ff66; --red: #ff4444; --bg: #050505; }
        
        /* O SEGREDO ESTÁ AQUI: Forçar altura mínima */
        html, body { 
            min-height: 100vh; 
            height: auto;
            background: var(--bg); 
            color: #eee; 
            font-family: monospace; 
            margin: 0; 
            padding: 0;
            display: block; /* Garante que o body se comporte como bloco */
        }

        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px;
            box-sizing: border-box;
        }

        /* Sistema de Telas */
        .tela { display: none; width: 100%; }
        .active { display: block !important; }

        /* Botões Estilizados */
        button { 
            background: #111; 
            border: 1px solid var(--green); 
            color: var(--green); 
            padding: 15px; 
            cursor: pointer; 
            width: 100%; 
            font-weight: bold; 
            margin-bottom: 10px; 
            text-transform: uppercase;
        }
        button:hover { background: var(--green); color: #000; }

        /* Estilos de Ficha */
        input, select, textarea { 
            background: #000; 
            color: #fff; 
            border: 1px solid #444; 
            padding: 12px; 
            width: 100%; 
            box-sizing: border-box; 
            margin-bottom: 15px; 
            font-size: 16px; /* Evita zoom automático no mobile */
        }

        .card { 
            border: 1px solid #222; 
            padding: 15px; 
            margin-bottom: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: #0a0a0a; 
        }

        nav { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; }
        nav button { font-size: 0.7rem; padding: 10px; flex: 1; }

        .btn-excluir { border-color: var(--red); color: var(--red); width: auto; padding: 5px 10px; margin: 0; }
    </style>
</head>
<body>

    <script>
        // Limpeza de emergência via URL: seunome.github.io/?reset=true
        if (window.location.search.includes('reset=true')) {
            localStorage.clear();
            alert("MEMÓRIA LIMPA!");
            window.location.href = window.location.pathname;
        }
    </script>

    <div class="container">
        <div id="tela-lista" class="tela active">
            <h1 style="color: var(--green); text-align: center; border-bottom: 2px solid var(--green); padding-bottom: 10px;">SISTEMA C.R.I.S.</h1>
            <div id="lista-agentes"></div>
            <button onclick="novoAgente()">+ RECRUTAR AGENTE</button>
        </div>

        <div id="tela-agente" class="tela">
            <nav>
                <button onclick="fecharAgente()" style="border-color: #fff; color: #fff;">← SAIR</button>
                <button onclick="aba('f')">FICHA</button>
                <button onclick="aba('i')">INV</button>
                <button onclick="aba('r')">RES</button>
            </nav>

            <div id="aba-f" class="secao">
                <label>CODINOME DO AGENTE:</label>
                <input type="text" id="ag-nome" oninput="salvar()">
                <label>N.E.R. (EXPOSIÇÃO):</label>
                <select id="ag-ner" onchange="salvar()">
                    <option value="5">5%</option>
                    <option value="25">25%</option>
                    <option value="50">50%</option>
                    <option value="75">75%</option>
                    <option value="99">99%</option>
                </select>
                <p style="color: #666; font-size: 0.8rem;">Dica: O nome e NER são salvos automaticamente ao digitar.</p>
            </div>

            <div id="aba-i" class="secao" style="display:none">
                <h2>INVENTÁRIO</h2>
                <input type="text" id="add-i" placeholder="Nome do item...">
                <button onclick="addItem()">ADICIONAR ITEM</button>
                <div id="lista-i"></div>
            </div>

            <div id="aba-r" class="secao" style="display:none">
                <h2>RESSONÂNCIAS</h2>
                <input type="text" id="add-rn" placeholder="Nome do Poder">
                <textarea id="add-rd" placeholder="Descrição do efeito..."></textarea>
                <button onclick="addRes()" style="border-color: #a033ff; color: #a033ff;">VINCULAR PODER</button>
                <div id="lista-r"></div>
            </div>
        </div>
    </div>

    <script>
        // Carrega do banco ou cria lista vazia
        let agentes = JSON.parse(localStorage.getItem('CRIS_DB_V6')) || [];
        let atual = null;

        function desenharLista() {
            const lista = document.getElementById('lista-agentes');
            lista.innerHTML = '';
            if (agentes.length === 0) {
                lista.innerHTML = '<p style="text-align:center; color:#444;">Nenhum agente registrado.</p>';
            }
            agentes.forEach((ag, i) => {
                lista.innerHTML += `
                    <div class="card">
                        <span onclick="abrir(${i})" style="cursor:pointer; flex-grow:1; font-weight:bold;">${ag.nome} [${ag.ner}%]</span>
                        <button class="btn-excluir" onclick="excluir(${i})">X</button>
                    </div>`;
            });
        }

        function novoAgente() {
            agentes.push({nome: "Agente Novo", ner: 5, inv: [], res: []});
            salvar(); 
            desenharLista();
        }

        function abrir(i) {
            atual = i;
            document.getElementById('tela-lista').classList.remove('active');
            document.getElementById('tela-agente').classList.add('active');
            document.getElementById('ag-nome').value = agentes[i].nome;
            document.getElementById('ag-ner').value = agentes[i].ner;
            aba('f'); // Garante que abre na aba ficha
            renderInv(); 
            renderRes();
        }

        function fecharAgente() {
            atual = null;
            document.getElementById('tela-agente').classList.remove('active');
            document.getElementById('tela-lista').classList.add('active');
            desenharLista();
        }

        function aba(id) {
            document.querySelectorAll('.secao').forEach(s => s.style.display = 'none');
            document.getElementById('aba-'+id).style.display = 'block';
        }

        function addItem() {
            const v = document.getElementById('add-i');
            if(v.value) { 
                agentes[atual].inv.push(v.value); 
                v.value=''; 
                salvar(); 
                renderInv(); 
            }
        }

        function renderInv() {
            const div = document.getElementById('lista-i');
            div.innerHTML = '';
            agentes[atual].inv.forEach((it, i) => {
                div.innerHTML += `<div class="card"><span>${it}</span> <button onclick="removerItem(${i})" class="btn-excluir">X</button></div>`;
            });
        }
        function removerItem(i) { agentes[atual].inv.splice(i,1); salvar(); renderInv(); }

        function addRes() {
            const n = document.getElementById('add-rn'), d = document.getElementById('add-rd');
            if(n.value) { 
                agentes[atual].res.push({n: n.value, d: d.value}); 
                n.value=''; d.value=''; 
                salvar(); 
                renderRes(); 
            }
        }

        function renderRes() {
            const div = document.getElementById('lista-r');
            div.innerHTML = '';
            agentes[atual].res.forEach((r, i) => {
                div.innerHTML += `
                    <div class="card" style="flex-direction:column; align-items:flex-start;">
                        <div style="width:100%; display:flex; justify-content:space-between;">
                            <strong>${r.n}</strong>
                            <button onclick="removerRes(${i})" class="btn-excluir">X</button>
                        </div>
                        <small style="color:#aaa; margin-top:5px;">${r.d}</small>
                    </div>`;
            });
        }
        function removerRes(i) { agentes[atual].res.splice(i,1); salvar(); renderRes(); }

        function excluir(i) { 
            if(confirm("Deseja apagar este agente?")) {
                agentes.splice(i, 1); 
                salvar(); 
                desenharLista(); 
            }
        }

        function salvar() { 
            if(atual !== null) {
                agentes[atual].nome = document.getElementById('ag-nome').value;
                agentes[atual].ner = document.getElementById('ag-ner').value;
            }
            localStorage.setItem('CRIS_DB_V6', JSON.stringify(agentes)); 
        }

        // Inicialização
        window.onload = desenharLista;
    </script>
</body>
</html>
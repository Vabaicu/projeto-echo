<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA D.E.R. // GESTÃO DE AGENTES</title>
    <style>
        :root { --green: #33ff66; --blue: #3399ff; --purple: #a033ff; --orange: #ff9933; --red: #ff3333; }
        body { background: #050505; color: #eee; font-family: 'Courier New', monospace; margin: 0; }
        
        /* Navegação */
        nav { background: #000; border-bottom: 2px solid var(--green); padding: 15px; display: none; justify-content: center; position: sticky; top: 0; z-index: 100; }
        nav button { background: none; border: 1px solid #333; color: #888; padding: 10px 15px; cursor: pointer; margin: 0 5px; font-weight: bold; font-size: 0.8rem; }
        nav button.active { color: var(--green); border-color: var(--green); box-shadow: 0 0 10px var(--green); }

        .container { max-width: 900px; margin: 20px auto; padding: 10px; }
        .aba { display: none; background: #111; border: 1px solid #222; padding: 20px; }
        .aba.active { display: block; }

        /* Tela Inicial */
        #tela-inicial { text-align: center; padding: 50px 20px; }
        .lista-agentes { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }
        .card-agente { background: #111; border: 1px solid var(--green); padding: 20px; cursor: pointer; transition: 0.3s; }
        .card-agente:hover { background: #1a1a1a; box-shadow: 0 0 15px var(--green); }
        .btn-novo { background: var(--green); color: #000; padding: 15px 30px; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* Elementos Comuns */
        h2 { color: var(--green); border-bottom: 1px solid #333; padding-bottom: 5px; text-transform: uppercase; font-size: 1.1rem; }
        label { display: block; color: var(--green); font-size: 0.75rem; margin: 10px 0 5px 0; }
        input, select, textarea { background: #000; color: #fff; border: 1px solid #444; padding: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        
        /* Inventário e Ressonâncias */
        .item-row { display: flex; justify-content: space-between; background: #0a0a0a; padding: 10px; border: 1px solid #222; margin-bottom: 5px; align-items: center; }
        .btn-del { background: var(--red); color: white; border: none; padding: 5px 10px; cursor: pointer; }
        .form-add { background: #1a1a1a; padding: 15px; border: 1px dashed var(--green); margin-bottom: 20px; }

        .pericia-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .pericia-item { display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; padding: 6px 10px; border: 1px solid #222; font-size: 0.8rem; }
        .sel-p { background: #111; border: 1px solid #444; color: #666; width: 50px; text-align: center; }
        .p5 { color: var(--green); border-color: var(--green); }
        .p10 { color: var(--blue); border-color: var(--blue); }
        .p15 { color: var(--purple); border-color: var(--purple); }
        .p20 { color: var(--orange); border-color: var(--orange); }
    </style>
</head>
<body>

    <section id="tela-inicial" class="container">
        <h1 style="color: var(--green); letter-spacing: 5px;">SISTEMA C.R.I.S.</h1>
        <p>CONEXÃO REMOTA DE INFORMAÇÕES SIGILOSAS</p>
        <div id="lista-agentes" class="lista-agentes">
            </div>
        <button class="btn-novo" onclick="novoAgente()">+ RECRUTAR NOVO AGENTE</button>
    </section>

    <nav id="nav-principal">
        <button onclick="voltarInicio()">INÍCIO</button>
        <button id="nav-ficha" class="active" onclick="trocarAba('ficha')">FICHA</button>
        <button id="nav-inv" onclick="trocarAba('inventario')">INVENTÁRIO</button>
        <button id="nav-res" onclick="trocarAba('ressonancias')">RESSONÂNCIAS</button>
    </nav>

    <div class="container" id="area-agente" style="display:none;">
        
        <div id="aba-ficha" class="aba active">
            <h2>TERMINAL DE AGENTE</h2>
            <label>CODINOME</label>
            <input type="text" id="agente-nome" onchange="salvarTudo()">
            <label>N.E.R. (EXPOSIÇÃO)</label>
            <select id="agente-ner" onchange="salvarTudo()">
                <option value="5">5%</option><option value="50">50%</option><option value="99">99%</option>
            </select>
            <div class="pericia-grid" id="grid-p">
                </div>
        </div>

        <div id="aba-inventario" class="aba">
            <h2>INVENTÁRIO DE CAMPO</h2>
            <div class="form-add">
                <input type="text" id="novo-item-nome" placeholder="Nome do Item...">
                <input type="text" id="novo-item-peso" placeholder="Peso/Espaço...">
                <button onclick="adicionarItem()" style="background:var(--green); border:none; padding:5px; width:100%; cursor:pointer;">ADICIONAR ITEM</button>
            </div>
            <div id="lista-itens"></div>
        </div>

        <div id="aba-ressonancias" class="aba">
            <h2>RESSONÂNCIAS MANIFESTADAS</h2>
            <div class="form-add">
                <input type="text" id="res-nome" placeholder="Nome da Ressonância...">
                <textarea id="res-efeito" placeholder="Efeito do poder..."></textarea>
                <button onclick="adicionarRessonancia()" style="background:var(--purple); border:none; padding:5px; width:100%; color:white; cursor:pointer;">VINCULAR PODER</button>
            </div>
            <div id="lista-ressonancias"></div>
        </div>

    </div>

    <script>
        let agentes = JSON.parse(localStorage.getItem('agentes_cris')) || [];
        let agenteAtualIdx = null;

        const periciasPadrao = ["Atletismo", "Crime", "Furtividade", "Investigação", "Luta", "Ocultismo", "Percepção", "Pontaria", "Tecnologia", "Vontade"];

        function iniciar() {
            const lista = document.getElementById('lista-agentes');
            lista.innerHTML = '';
            agentes.forEach((ag, index) => {
                lista.innerHTML += `
                    <div class="card-agente" onclick="abrirAgente(${index})">
                        <strong>${ag.nome || 'Sem Nome'}</strong><br>
                        <small>N.E.R. ${ag.ner}%</small>
                    </div>`;
            });
        }

        function novoAgente() {
            const novo = {
                nome: "Novo Agente",
                ner: 5,
                pericias: {},
                itens: [{nome: "Lanterna", peso: "1"}, {nome: "Kit Médico", peso: "2"}],
                ressonancias: [{nome: "Eco Silencioso", efeito: "Abafa sons em um raio de 3 metros."}]
            };
            agentes.push(novo);
            abrirAgente(agentes.length - 1);
        }

        function abrirAgente(index) {
            agenteAtualIdx = index;
            const ag = agentes[index];
            document.getElementById('tela-inicial').style.display = 'none';
            document.getElementById('nav-principal').style.display = 'flex';
            document.getElementById('area-agente').style.display = 'block';
            
            document.getElementById('agente-nome').value = ag.nome;
            document.getElementById('agente-ner').value = ag.ner;
            
            carregarPericias();
            carregarItens();
            carregarRessonancias();
        }

        function carregarPericias() {
            const grid = document.getElementById('grid-p');
            grid.innerHTML = '';
            periciasPadrao.forEach(p => {
                const val = agentes[agenteAtualIdx].pericias[p] || 0;
                grid.innerHTML += `
                    <div class="pericia-item">
                        <span>${p}</span>
                        <select class="sel-p ${val>0?'p'+val:''}" onchange="salvarPericia('${p}', this)">
                            <option value="0" ${val==0?'selected':''}>0</option>
                            <option value="5" ${val==5?'selected':''}>5</option>
                            <option value="10" ${val==10?'selected':''}>10</option>
                            <option value="15" ${val==15?'selected':''}>15</option>
                            <option value="20" ${val==20?'selected':''}>20</option>
                        </select>
                    </div>`;
            });
        }

        function salvarPericia(p, el) {
            agentes[agenteAtualIdx].pericias[p] = parseInt(el.value);
            el.className = "sel-p " + (el.value > 0 ? "p" + el.value : "");
            salvarTudo();
        }

        function carregarItens() {
            const div = document.getElementById('lista-itens');
            div.innerHTML = '';
            agentes[agenteAtualIdx].itens.forEach((it, i) => {
                div.innerHTML += `<div class="item-row"><span>${it.nome} (Peso: ${it.peso})</span><button class="btn-del" onclick="removerItem(${i})">X</button></div>`;
            });
        }

        function adicionarItem() {
            const nome = document.getElementById('novo-item-nome').value;
            const peso = document.getElementById('novo-item-peso').value;
            if(nome) {
                agentes[agenteAtualIdx].itens.push({nome, peso});
                document.getElementById('novo-item-nome').value = '';
                carregarItens();
                salvarTudo();
            }
        }

        function removerItem(i) { agentes[agenteAtualIdx].itens.splice(i, 1); carregarItens(); salvarTudo(); }

        function carregarRessonancias() {
            const div = document.getElementById('lista-ressonancias');
            div.innerHTML = '';
            agentes[agenteAtualIdx].ressonancias.forEach((res, i) => {
                div.innerHTML += `<div class="item-row" style="flex-direction:column; align-items:start;"><strong>${res.nome}</strong><small>${res.efeito}</small><button class="btn-del" onclick="removerRes(${i})" style="align-self:end">Remover</button></div>`;
            });
        }

        function adicionarRessonancia() {
            const nome = document.getElementById('res-nome').value;
            const efeito = document.getElementById('res-efeito').value;
            if(nome) {
                agentes[agenteAtualIdx].ressonancias.push({nome, efeito});
                document.getElementById('res-nome').value = '';
                document.getElementById('res-efeito').value = '';
                carregarRessonancias();
                salvarTudo();
            }
        }

        function removerRes(i) { agentes[agenteAtualIdx].ressonancias.splice(i, 1); carregarRessonancias(); salvarTudo(); }

        function trocarAba(aba) {
            document.querySelectorAll('.aba').forEach(a => a.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('aba-' + aba).classList.add('active');
            document.getElementById('nav-' + (aba.substring(0,3))).classList.add('active');
        }

        function voltarInicio() { 
            salvarTudo();
            document.getElementById('tela-inicial').style.display = 'block';
            document.getElementById('nav-principal').style.display = 'none';
            document.getElementById('area-agente').style.display = 'none';
            iniciar();
        }

        function salvarTudo() {
            if(agenteAtualIdx !== null) {
                agentes[agenteAtualIdx].nome = document.getElementById('agente-nome').value;
                agentes[agenteAtualIdx].ner = document.getElementById('agente-ner').value;
            }
            localStorage.setItem('agentes_cris', JSON.stringify(agentes));
        }

        window.onload = iniciar;
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>C.R.I.S. // DATABASE V7</title>
    <style>
        :root { --green: #33ff66; --blue: #3399ff; --purple: #a033ff; --orange: #ff9933; --red: #ff4444; --bg: #050505; }
        
        html, body { min-height: 100vh; background: var(--bg); color: #eee; font-family: monospace; margin: 0; padding: 0; }
        .container { max-width: 700px; margin: 0 auto; padding: 20px; box-sizing: border-box; }

        /* Telas */
        .tela { display: none; width: 100%; }
        .active { display: block !important; }

        /* Estilos de Ficha */
        h2 { color: var(--green); border-bottom: 1px solid #333; padding-bottom: 5px; font-size: 1rem; text-transform: uppercase; margin-top: 25px; }
        label { display: block; color: var(--green); font-size: 0.7rem; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { background: #000; color: #fff; border: 1px solid #444; padding: 12px; width: 100%; box-sizing: border-box; margin-bottom: 15px; font-family: monospace; }
        
        #desc-classe { background: #0a0a0a; padding: 15px; border-left: 3px solid var(--green); font-size: 0.8rem; color: #bbb; margin-bottom: 20px; }

        /* Grid de Perícias */
        .p-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .p-item { display: flex; justify-content: space-between; align-items: center; background: #0d0d0d; padding: 8px; border: 1px solid #222; font-size: 0.75rem; }
        .sel-p { width: 55px; padding: 5px; margin-bottom: 0; text-align: center; cursor: pointer; font-weight: bold; color: #666; }
        
        /* Cores das Perícias */
        .p5 { color: var(--green) !important; border-color: var(--green) !important; }
        .p10 { color: var(--blue) !important; border-color: var(--blue) !important; }
        .p15 { color: var(--purple) !important; border-color: var(--purple) !important; }
        .p20 { color: var(--orange) !important; border-color: var(--orange) !important; }

        /* Cards e Nav */
        .card { border: 1px solid #222; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; }
        nav { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; position: sticky; top: 0; background: var(--bg); padding-top: 10px; z-index: 10; }
        nav button { flex: 1; padding: 12px; background: #111; border: 1px solid #333; color: #888; cursor: pointer; font-weight: bold; font-size: 0.7rem; }
        nav button.active-nav { border-color: var(--green); color: var(--green); box-shadow: 0 0 10px rgba(51, 255, 102, 0.2); }
        
        button.principal { background: #111; border: 1px solid var(--green); color: var(--green); padding: 15px; cursor: pointer; width: 100%; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }
        .btn-excluir { border-color: var(--red); color: var(--red); width: auto; padding: 5px 10px; margin: 0; font-size: 0.7rem; }
    </style>
</head>
<body>

    <div class="container">
        <div id="tela-lista" class="tela active">
            <h1 style="color: var(--green); text-align: center; letter-spacing: 3px;">SISTEMA C.R.I.S.</h1>
            <div id="lista-agentes"></div>
            <button class="principal" onclick="novoAgente()">+ RECRUTAR AGENTE</button>
        </div>

        <div id="tela-agente" class="tela">
            <nav id="menu-nav">
                <button onclick="fecharAgente()">SAIR</button>
                <button id="btn-f" class="active-nav" onclick="aba('f')">FICHA</button>
                <button id="btn-i" onclick="aba('i')">INV</button>
                <button id="btn-r" onclick="aba('r')">RES</button>
            </nav>

            <div id="aba-f" class="secao">
                <label>CODINOME:</label>
                <input type="text" id="ag-nome" placeholder="Codinome do Agente" oninput="salvar()">
                
                <label>N.E.R. % (EXPOSIÇÃO):</label>
                <select id="ag-ner" onchange="salvar()">
                    <option value="5">5%</option><option value="25">25%</option><option value="50">50%</option><option value="75">75%</option><option value="99">99%</option>
                </select>

                <label>ESPECIALIZAÇÃO (D.E.R.):</label>
                <select id="ag-classe" onchange="atualizarClasse()">
                    <option value="">Selecione...</option>
                    <option value="tatico">Tático de Assalto</option>
                    <option value="sintonizador">Sintonizador de Echo</option>
                    <option value="especialista">Especialista Técnico</option>
                </select>
                <div id="desc-classe">Aguardando diretrizes...</div>

                <h2>MATRIZ DE PERÍCIAS</h2>
                <div class="p-grid" id="grid-pericias"></div>
            </div>

            <div id="aba-i" class="secao" style="display:none">
                <h2>INVENTÁRIO</h2>
                <input type="text" id="add-i" placeholder="Nome do item...">
                <button class="principal" onclick="addItem()">ADICIONAR ITEM</button>
                <div id="lista-i"></div>
            </div>

            <div id="aba-r" class="secao" style="display:none">
                <h2>RESSONÂNCIAS</h2>
                <input type="text" id="add-rn" placeholder="Nome do Poder">
                <textarea id="add-rd" placeholder="Descrição do efeito..."></textarea>
                <button class="principal" style="border-color: var(--purple); color: var(--purple);" onclick="addRes()">VINCULAR PODER</button>
                <div id="lista-r"></div>
            </div>
        </div>
    </div>

    <script>
        let agentes = JSON.parse(localStorage.getItem('CRIS_V7_DATA')) || [];
        let atual = null;

        const PERICIAS_NOMES = [
            "Acrobacia", "Adestramento", "Artes", "Atletismo", "Atualidades", "Ciências", "Crime", 
            "Diplomacia", "Enganação", "Fortitude", "Furtividade", "Iniciativa", "Intimidação", 
            "Intuição", "Investigação", "Luta", "Medicina", "Ocultismo", "Percepção", "Pilotagem", 
            "Pontaria", "Reflexos", "Religião", "Sobrevivência", "Tática", "Tecnologia", "Vontade"
        ];

        function desenharLista() {
            const lista = document.getElementById('lista-agentes');
            lista.innerHTML = '';
            agentes.forEach((ag, i) => {
                lista.innerHTML += `
                    <div class="card">
                        <span onclick="abrir(${i})" style="cursor:pointer; flex-grow:1; font-weight:bold;">${ag.nome} [NER ${ag.ner}%]</span>
                        <button class="btn-excluir" onclick="excluir(${i})">X</button>
                    </div>`;
            });
        }

        function novoAgente() {
            agentes.push({nome: "Agente Novo", ner: 5, classe: "", pericias: {}, inv: [], res: []});
            salvar(); desenharLista();
        }

        function abrir(i) {
            atual = i;
            document.getElementById('tela-lista').classList.remove('active');
            document.getElementById('tela-agente').classList.add('active');
            
            document.getElementById('ag-nome').value = agentes[i].nome;
            document.getElementById('ag-ner').value = agentes[i].ner;
            document.getElementById('ag-classe').value = agentes[i].classe || "";
            
            atualizarClasse(false);
            renderPericias();
            renderInv();
            renderRes();
            aba('f');
        }

        function renderPericias() {
            const grid = document.getElementById('grid-pericias');
            grid.innerHTML = '';
            PERICIAS_NOMES.forEach(p => {
                const v = agentes[atual].pericias[p] || 0;
                grid.innerHTML += `
                    <div class="p-item">
                        <span>${p}</span>
                        <select class="sel-p ${v>0?'p'+v:''}" onchange="salvarP('${p}', this)">
                            <option value="0" ${v==0?'selected':''}>0</option>
                            <option value="5" ${v==5?'selected':''}>5</option>
                            <option value="10" ${v==10?'selected':''}>10</option>
                            <option value="15" ${v==15?'selected':''}>15</option>
                            <option value="20" ${v==20?'selected':''}>20</option>
                        </select>
                    </div>`;
            });
        }

        function salvarP(p, el) {
            agentes[atual].pericias[p] = parseInt(el.value);
            salvar();
            renderPericias();
        }

        function atualizarClasse(deveSalvar = true) {
            const info = {
                tatico: "TÁTICO: Foco em combate e resistência física. +5 PV por NEX.",
                sintonizador: "SINTONIZADOR: Conexão direta com Echos. Manipula a realidade.",
                especialista: "ESPECIALISTA: Mestre de perícias e tecnologia. Hackeia o sistema."
            };
            const val = document.getElementById('ag-classe').value;
            document.getElementById('desc-classe').innerText = info[val] || "Selecione uma especialidade...";
            if(deveSalvar) { agentes[atual].classe = val; salvar(); }
        }

        function aba(id) {
            document.querySelectorAll('.secao').forEach(s => s.style.display = 'none');
            document.querySelectorAll('#menu-nav button').forEach(b => b.classList.remove('active-nav'));
            document.getElementById('aba-'+id).style.display = 'block';
            document.getElementById('btn-'+id).classList.add('active-nav');
        }

        // Funções de Inventário e Ressonância (Mantidas da V6)
        function addItem() { const v = document.getElementById('add-i'); if(v.value) { agentes[atual].inv.push(v.value); v.value=''; salvar(); renderInv(); } }
        function renderInv() {
            const div = document.getElementById('lista-i');
            div.innerHTML = '';
            agentes[atual].inv.forEach((it, i) => { div.innerHTML += `<div class="card"><span>${it}</span> <button onclick="agentes[atual].inv.splice(${i},1); salvar(); renderInv();" class="btn-excluir">X</button></div>`; });
        }
        function addRes() { const n = document.getElementById('add-rn'), d = document.getElementById('add-rd'); if(n.value) { agentes[atual].res.push({n: n.value, d: d.value}); n.value=''; d.value=''; salvar(); renderRes(); } }
        function renderRes() {
            const div = document.getElementById('lista-r');
            div.innerHTML = '';
            agentes[atual].res.forEach((r, i) => { div.innerHTML += `<div class="card" style="flex-direction:column; align-items:flex-start;"><strong>${r.n}</strong><small>${r.d}</small><button onclick="agentes[atual].res.splice(${i},1); salvar(); renderRes();" class="btn-excluir" style="align-self:flex-end">X</button></div>`; });
        }

        function fecharAgente() { atual = null; document.getElementById('tela-agente').classList.remove('active'); document.getElementById('tela-lista').classList.add('active'); desenharLista(); }
        function excluir(i) { if(confirm("Apagar agente?")) { agentes.splice(i, 1); salvar(); desenharLista(); } }
        function salvar() { 
            if(atual !== null) { 
                agentes[atual].nome = document.getElementById('ag-nome').value; 
                agentes[atual].ner = document.getElementById('ag-ner').value;
            }
            localStorage.setItem('CRIS_V7_DATA', JSON.stringify(agentes)); 
        }

        window.onload = desenharLista;
    </script>
</body>
</html>